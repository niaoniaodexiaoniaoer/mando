import{_ as T,b as j,d as O,c as n,a as l,n as k,t as o,e as P,f as B,g as i,F as v,h as $,w as c,v as y,i as S,r,j as F,u as L,o as a}from"./index-B1jubR9S.js";const z={class:"admin-wrapper"},A={class:"sidebar"},J={class:"user-bottom"},K={class:"u-info"},R={class:"main-content"},q={class:"top-bar"},G={class:"page-title"},H={key:0,style:{"margin-left":"10px",opacity:"0.5","font-size":"12px"}},Q={key:0,class:"probe-alert"},W={class:"workspace"},X={class:"scroll-container"},Y={class:"grid-table"},Z={key:0},ll={key:1},sl={key:2},el={key:3},tl={class:"ops"},ol=["onClick"],nl=["onClick"],al={class:"ops"},ul=["onClick"],dl=["onClick"],il={class:"ops"},rl=["onClick"],vl={class:"sub-text"},cl=["src","onClick"],pl={key:1,class:"no-photo"},_l={class:"time-font"},ml={class:"loc-tag"},hl={class:"device-cell"},kl=["title"],yl={class:"img-modal-content"},fl=["src"],gl={key:1,class:"modal-overlay"},bl={class:"modal-content"},Cl={class:"modal-header"},wl={class:"modal-body"},$l={key:0},Dl={class:"field"},Il={class:"field"},Sl={class:"field"},Vl={class:"field"},xl={class:"field"},Ul=["value"],El={class:"field"},Nl=["value"],Ml={key:1},Tl={class:"field"},jl={class:"modal-footer"},Ol={__name:"Dashboard",setup(Pl){const V=L(),t=r("users"),b=r([]),C=r({roles:[],companies:[]}),p=r(!1),_=r(!1),u=r({}),m=r({triggered:!1,count:0,message:""}),f=r(null),x=JSON.parse(localStorage.getItem("user")||"{}"),D=F(()=>({users:"账号管理",companies:"单位管理",roles:"角色管理",logs:"登录日志"})[t.value]),g=async()=>{try{const s=await(await fetch(`/api/admin/${t.value}`)).json();t.value==="logs"?(b.value=s.data,m.value=s.probe):b.value=s}catch(d){console.error("Fetch error:",d)}},U=async()=>{const d=await fetch("/api/admin/options");C.value=await d.json()},E=()=>{_.value=!1,u.value=t.value==="users"?{real_name:"",phone:"",username:"",password:"",role_id:1,company_id:1}:{name:""},p.value=!0},I=d=>{_.value=!0,u.value={...d},p.value=!0},N=async()=>{const d=_.value?"PUT":"POST",s=_.value?`/api/admin/${t.value}/${u.value.id}`:`/api/admin/${t.value}`;await fetch(s,{method:d,headers:{"Content-Type":"application/json"},body:JSON.stringify(u.value)}),p.value=!1,g()},w=async d=>{confirm("确定删除该记录吗？")&&(await fetch(`/api/admin/${t.value}/${d}`,{method:"DELETE"}),g())},M=()=>{localStorage.removeItem("user"),V.push("/login")};return j(t,()=>{g()}),O(()=>{g(),U()}),(d,s)=>(a(),n("div",z,[l("aside",A,[s[13]||(s[13]=l("div",{class:"brand"},"M&O ADMIN",-1)),l("nav",null,[l("div",{class:k(["menu-item",{active:t.value==="users"}]),onClick:s[0]||(s[0]=e=>t.value="users")},"账号管理",2),l("div",{class:k(["menu-item",{active:t.value==="companies"}]),onClick:s[1]||(s[1]=e=>t.value="companies")},"单位管理",2),l("div",{class:k(["menu-item",{active:t.value==="roles"}]),onClick:s[2]||(s[2]=e=>t.value="roles")},"角色管理",2),l("div",{class:k(["menu-item",{active:t.value==="logs"}]),onClick:s[3]||(s[3]=e=>t.value="logs")},"登录日志",2)]),l("div",J,[l("div",K,o(P(x).real_name||"管理员"),1),l("div",{class:"logout-link",onClick:M},"退出登录")])]),l("section",R,[l("header",q,[l("div",G,[B(o(D.value)+" ",1),t.value==="logs"&&m.value.count?(a(),n("small",H," (共 "+o(m.value.count)+" 条) ",1)):i("",!0)]),t.value==="logs"&&m.value.triggered?(a(),n("div",Q," ⚠️ "+o(m.value.message),1)):i("",!0),t.value!=="logs"?(a(),n("button",{key:1,class:"add-btn",onClick:E}," 新增"+o(D.value.slice(0,2)),1)):i("",!0)]),l("div",W,[l("div",X,[l("table",Y,[l("thead",null,[t.value==="users"?(a(),n("tr",Z,[...s[14]||(s[14]=[l("th",{width:"60"},"ID",-1),l("th",null,"姓名",-1),l("th",null,"手机号",-1),l("th",null,"账号",-1),l("th",null,"密码",-1),l("th",null,"单位名称",-1),l("th",null,"单位ID",-1),l("th",null,"角色名称",-1),l("th",null,"角色ID",-1),l("th",{width:"100"},"操作",-1)])])):t.value==="companies"?(a(),n("tr",ll,[...s[15]||(s[15]=[l("th",{width:"80"},"ID",-1),l("th",null,"单位名称",-1),l("th",{width:"100"},"操作",-1)])])):t.value==="roles"?(a(),n("tr",sl,[...s[16]||(s[16]=[l("th",{width:"80"},"ID",-1),l("th",null,"角色名称",-1),l("th",null,"角色Key",-1),l("th",{width:"100"},"操作",-1)])])):t.value==="logs"?(a(),n("tr",el,[...s[17]||(s[17]=[l("th",{width:"50"},"ID",-1),l("th",null,"采集人员",-1),l("th",null,"合规自拍",-1),l("th",null,"登录时间",-1),l("th",null,"地理位置",-1),l("th",null,"认证状态",-1),l("th",null,"IP/设备信息",-1)])])):i("",!0)]),l("tbody",null,[(a(!0),n(v,null,$(b.value,e=>(a(),n("tr",{key:e.id},[t.value==="users"?(a(),n(v,{key:0},[l("td",null,o(e.id),1),l("td",null,o(e.real_name),1),l("td",null,o(e.phone),1),l("td",null,o(e.username),1),s[18]||(s[18]=l("td",{class:"pwd-mask"},"******",-1)),l("td",null,o(e.company_name),1),l("td",null,o(e.company_id),1),l("td",null,o(e.role_name),1),l("td",null,o(e.role_id),1),l("td",tl,[l("span",{onClick:h=>I(e)},"修改",8,ol),l("span",{onClick:h=>w(e.id)},"删除",8,nl)])],64)):t.value==="companies"?(a(),n(v,{key:1},[l("td",null,o(e.id),1),l("td",null,o(e.name),1),l("td",al,[l("span",{onClick:h=>I(e)},"修改",8,ul),l("span",{onClick:h=>w(e.id)},"删除",8,dl)])],64)):t.value==="roles"?(a(),n(v,{key:2},[l("td",null,o(e.id),1),l("td",null,o(e.role_name),1),l("td",null,[l("code",null,o(e.role_key),1)]),l("td",il,[l("span",{onClick:h=>w(e.id)},"删除",8,rl)])],64)):t.value==="logs"?(a(),n(v,{key:3},[l("td",null,o(e.id),1),l("td",null,[l("b",null,o(e.real_name),1),s[19]||(s[19]=l("br",null,null,-1)),l("small",vl,o(e.username),1)]),l("td",null,[e.photo_url?(a(),n("img",{key:0,src:e.photo_url,class:"log-thumb",onClick:h=>f.value=e.photo_url},null,8,cl)):(a(),n("span",pl,"无采集"))]),l("td",_l,o(e.login_time),1),l("td",null,[l("span",ml,o(e.location),1)]),l("td",null,[l("span",{class:k(["status-tag",e.status])},o(e.status==="SUCCESS"?"认证成功":"认证失败"),3)]),l("td",hl,[l("code",null,o(e.ip_address),1),l("div",{class:"ua-text",title:e.device_info},o(e.device_info),9,kl)])],64)):i("",!0)]))),128))])])])])]),f.value?(a(),n("div",{key:0,class:"img-modal-overlay",onClick:s[4]||(s[4]=e=>f.value=null)},[l("div",yl,[l("img",{src:f.value},null,8,fl),s[20]||(s[20]=l("p",null,"点击空白处关闭",-1))])])):i("",!0),p.value?(a(),n("div",gl,[l("div",bl,[l("div",Cl,o(_.value?"修改记录":"新增记录"),1),l("div",wl,[t.value==="users"?(a(),n("div",$l,[l("div",Dl,[s[21]||(s[21]=l("label",null,"姓名",-1)),c(l("input",{"onUpdate:modelValue":s[5]||(s[5]=e=>u.value.real_name=e)},null,512),[[y,u.value.real_name]])]),l("div",Il,[s[22]||(s[22]=l("label",null,"手机号",-1)),c(l("input",{"onUpdate:modelValue":s[6]||(s[6]=e=>u.value.phone=e)},null,512),[[y,u.value.phone]])]),l("div",Sl,[s[23]||(s[23]=l("label",null,"账号",-1)),c(l("input",{"onUpdate:modelValue":s[7]||(s[7]=e=>u.value.username=e)},null,512),[[y,u.value.username]])]),l("div",Vl,[s[24]||(s[24]=l("label",null,"密码",-1)),c(l("input",{"onUpdate:modelValue":s[8]||(s[8]=e=>u.value.password=e),type:"password"},null,512),[[y,u.value.password]])]),l("div",xl,[s[25]||(s[25]=l("label",null,"所属单位",-1)),c(l("select",{"onUpdate:modelValue":s[9]||(s[9]=e=>u.value.company_id=e)},[(a(!0),n(v,null,$(C.value.companies,e=>(a(),n("option",{key:e.id,value:e.id},o(e.name),9,Ul))),128))],512),[[S,u.value.company_id]])]),l("div",El,[s[26]||(s[26]=l("label",null,"系统角色",-1)),c(l("select",{"onUpdate:modelValue":s[10]||(s[10]=e=>u.value.role_id=e)},[(a(!0),n(v,null,$(C.value.roles,e=>(a(),n("option",{key:e.id,value:e.id},o(e.name),9,Nl))),128))],512),[[S,u.value.role_id]])])])):t.value==="companies"?(a(),n("div",Ml,[l("div",Tl,[s[27]||(s[27]=l("label",null,"单位名称",-1)),c(l("input",{"onUpdate:modelValue":s[11]||(s[11]=e=>u.value.name=e)},null,512),[[y,u.value.name]])])])):i("",!0)]),l("div",jl,[l("button",{onClick:s[12]||(s[12]=e=>p.value=!1)},"取消"),l("button",{class:"primary",onClick:N},"确定保存")])])])):i("",!0)]))}},Fl=T(Ol,[["__scopeId","data-v-964db6ef"]]);export{Fl as default};
